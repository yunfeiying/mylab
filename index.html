<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Highlighti Mobile</title>
    <link rel="stylesheet" href="mobile.css">
    <link rel="manifest" href="mobile-manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2965/2965358.png">
</head>







<body>
    <div id="app">
        <!-- ============================== -->
        <!-- 1. VIEW HOME (Highlights Feed) -->
        <!-- ============================== -->
        <div id="view-home" class="app-view active">
            <header class="notes-header">
                <button class="header-btn menu-btn">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M3 12h18M3 6h18M3 18h18" />
                    </svg>
                </button>
                <h1 class="header-title">Highlighti</h1>
                <button class="header-btn user-btn">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.8">
                        <circle cx="12" cy="8" r="4" />
                        <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" />
                    </svg>
                </button>
            </header>

            <main class="notes-list-content">
                <div class="list-title" style="font-size:14px; color:#8e8e93; margin-top:20px; margin-bottom:10px;">
                    TODAY</div>
                <!-- Dynamic Content Will Be Injected Here -->
                <div id="home-dyn-list"></div>
            </main>
        </div>

        <!-- ============================== -->
        <!-- 2. VIEW SEARCH -->
        <!-- ============================== -->
        <div id="view-search" class="app-view">
            <header class="notes-header">
                <button class="header-btn back-btn" onclick="mobileCore.switchTab('home')">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <h1 class="header-title">Search</h1>
            </header>
            <div class="search-bar-container">
                <div class="search-bar">
                    <span class="search-icon">
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24">
                            <circle cx="11" cy="11" r="8" />
                            <line x1="21" y1="21" x2="16.65" y2="16.65" />
                        </svg>
                    </span>
                    <input type="text" placeholder="Search chats, reader...">
                </div>
            </div>
            <main class="notes-list-content">
                <div class="list-title">Recent Searches</div>
                <!-- Recent searches placeholder -->
            </main>
        </div>



        <!-- ============================== -->
        <!-- 4. VIEW NOTES (List) -->
        <!-- ============================== -->
        <div id="view-notes" class="app-view">
            <header class="notes-header">
                <button class="header-btn back-btn" onclick="mobileCore.switchTab('home')">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <h1 class="header-title">Notes</h1>
                <button class="header-btn" style="margin-left:auto;" onclick="mobileEditor.initNewNote()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14" />
                    </svg>
                </button>
            </header>
            <main class="notes-list-content">
                <div id="notes-dyn-list"></div>
            </main>
        </div>

        <!-- ============================== -->
        <!-- 5. VIEW CHAT (Tab / Full Screen) -->
        <!-- ============================== -->
        <div id="view-chat" class="app-view">
            <header class="gemini-header">
                <!-- Back Button for Full Screen Mode -->
                <button class="header-btn back-btn" onclick="mobileCore.exitChat()">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <h1 class="header-title" id="chat-title">AI Assistant</h1>
                <button class="header-btn" id="btn-settings">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="1" />
                        <circle cx="19" cy="12" r="1" />
                        <circle cx="5" cy="12" r="1" />
                    </svg>
                </button>
            </header>
            <main id="chat-content" class="chat-content">
                <div id="messages-container"></div>
            </main>
            <div class="input-area">
                <div id="attachment-preview-container" class="hidden"></div>
                <div class="input-tools-row">
                    <button class="tool-btn" id="btn-chat-attach" style="color:#8e8e93;">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24">
                            <path d="M12 5v14M5 12h14" />
                        </svg>
                    </button>
                    <button class="tool-btn" id="btn-chat-camera" style="color:#8e8e93;">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24">
                            <path
                                d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                            <circle cx="12" cy="13" r="4" />
                        </svg>
                    </button>
                    <div class="input-field-wrapper">
                        <input type="text" id="chat-input" class="chat-input-field" placeholder="Ask anything...">
                    </div>
                    <button class="tool-btn" id="btn-chat-send" style="color:var(--ios-blue)">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                        </svg>
                    </button>
                </div>
                <!-- Hidden Inputs -->
                <input type="file" id="chat-file-input" class="hidden" multiple>
                <input type="file" id="chat-camera-input" class="hidden" accept="image/*" capture="camera">
            </div>
        </div>

        <!-- Reader View (Literal Clone of Notes) -->
        <div id="view-reading" class="app-view">
            <header class="notes-header">
                <button class="header-btn back-btn" onclick="mobileCore.switchTab('home')">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <h1 class="header-title">Reader</h1>
                <div class="header-tools" style="margin-left:auto;">
                    <button class="tool-btn">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24">
                            <circle cx="11" cy="11" r="8" />
                            <line x1="21" y1="21" x2="16.65" y2="16.65" />
                        </svg>
                    </button>
                </div>
            </header>
            <main class="notes-list-content">
                <div id="reading-dyn-list"></div>
            </main>
        </div>

        <!-- ============================== -->
        <!-- SUB-VIEW: EDITOR (Full Screen) -->
        <!-- ============================== -->
        <div id="view-editor" class="app-view full-screen-view">
            <header class="gemini-header">
                <button class="header-btn back-btn" onclick="mobileEditor.saveNote(); mobileCore.goBack()">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <div class="header-title-container" style="flex:1; display:flex; justify-content:center;">
                    <input type="text" class="editor-header-title" placeholder="Untitled Note"
                        style="border:none; text-align:center; font-weight:600; font-size:17px; background:transparent; width:80%;">
                </div>
                <!-- Save Button -->
                <button class="header-btn" onclick="mobileEditor.saveNote()" style="font-weight:600;">Save</button>
                <!-- Editor Menu -->
                <button class="header-btn" onclick="mobileEditor.showEditorMenu(event)">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="1" />
                        <circle cx="19" cy="12" r="1" />
                        <circle cx="5" cy="12" r="1" />
                    </svg>
                </button>
            </header>
            <main class="editor-content">
                <div class="editor-body" contenteditable="true" spellcheck="false">
                    Start typing...
                </div>
            </main>

            <div class="editor-toolbar-floating">
                <div class="ai-prompt-bar">
                    <input type="text" placeholder="/ai Write a poem..." id="ai-quick-input">
                    <button id="ai-quick-send">‚ú®</button>
                </div>
                <div class="editor-toolbar">
                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="document.execCommand('bold')"><b>B</b></button>
                        <button class="toolbar-btn" onclick="document.execCommand('italic')"><i>I</i></button>
                        <button class="toolbar-btn" onclick="mobileEditor.insertList('insertOrderedList')">1.</button>
                        <button class="toolbar-btn" onclick="mobileEditor.insertList('insertUnorderedList')">‚Ä¢</button>
                        <button class="toolbar-btn" onclick="mobileEditor.toggleTodo()">‚òëÔ∏è</button>
                    </div>
                    <div class="spacer"></div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn" id="btn-ai-magic">‚ú® AI</button>
                        <button class="toolbar-btn" id="btn-ocr-trigger">üì∑</button>
                    </div>
                </div>
            </div>
            <!-- Hidden OCR Input -->
            <input type="file" id="editor-ocr-input" class="hidden" accept="image/*" capture="camera">
        </div>

        <!-- ============================== -->
        <!-- SUB-VIEW: READER DETAIL (Full Screen) -->
        <!-- ============================== -->
        <div id="view-reader-detail" class="app-view full-screen-view">
            <header class="gemini-header">
                <button class="header-btn back-btn" onclick="mobileCore.goBack()">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <div style="flex:1; text-align:center; font-weight:600;">Reader View</div>
                <button class="header-btn">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
                    </svg>
                </button>
            </header>
            <main class="editor-content">
                <h1 class="editor-title" style="font-size:24px;">The Future of AI</h1>
                <div class="note-time" style="margin-bottom:20px;">TechCrunch ‚Ä¢ 5 min read</div>
                <div style="width:100%; height:200px; background:#f0f0f0; border-radius:12px; margin-bottom:20px;">
                </div>
                <div class="editor-body" style="font-family:Georgia, serif;">
                    <p>Artificial Intelligence is reshaping our world...</p>
                    <p>In recent years, we have seen exponential growth in...</p>
                </div>
            </main>
            <!-- Reader Context AI -->
            <div class="editor-toolbar">
                <button class="toolbar-btn">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8" />
                        <line x1="21" y1="21" x2="16.65" y2="16.65" />
                    </svg>
                </button>
                <div class="spacer"></div>
                <button class="toolbar-btn" style="color:var(--ios-blue); width:auto; gap:4px; padding:0 8px;">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                    </svg>
                    <span>Summarize</span>
                </button>
            </div>
        </div>

        <!-- ============================== -->
        <!-- GLOBAL: BOTTOM TAB BAR -->
        <!-- ============================== -->
        <nav class="bottom-tab-bar" id="main-tab-bar">
            <!-- 1. Home (Highlights) -->
            <button class="tab-btn active" data-target="view-home">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                    <polyline points="9 22 9 12 15 12 15 22" />
                </svg>
                <span style="font-size:10px; margin-top:2px;">Home</span>
            </button>

            <!-- 1.5 Chat -->
            <button class="tab-btn" data-target="view-chat">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <!-- Chat Bubble Icon -->
                    <path
                        d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" />
                </svg>
                <span style="font-size:10px; margin-top:2px;">Chat</span>
            </button>

            <!-- 2. Search -->
            <button class="tab-btn" data-target="view-search">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8" />
                    <line x1="21" y1="21" x2="16.65" y2="16.65" />
                </svg>
                <span style="font-size:10px; margin-top:2px;">Search</span>
            </button>
            <!-- 3. Reader -->
            <button class="tab-btn" data-target="view-reading">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
                </svg>
                <span style="font-size:10px; margin-top:2px;">Reader</span>
            </button>
            <!-- 4. Notes -->
            <button class="tab-btn" data-target="view-notes">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                    <polyline points="14 2 14 8 20 8" />
                    <line x1="16" y1="13" x2="8" y2="13" />
                    <line x1="16" y1="17" x2="8" y2="17" />
                    <polyline points="10 9 9 9 8 9" />
                </svg>
                <span style="font-size:10px; margin-top:2px;">Notes</span>
            </button>
        </nav>

    </div>


    <!-- ============================== -->
    <!-- OVERLAY: ACTION SHEET -->
    <!-- ============================== -->
    <div id="action-sheet-overlay" class="action-sheet-overlay hidden">
        <div class="action-sheet">
            <div class="action-btn-group">
                <button class="action-btn" id="act-gdrive">
                    <span class="action-icon">üîÑ</span>
                    <span>Google Drive Sync</span>
                </button>
                <button class="action-btn" id="act-webdav">
                    <span class="action-icon">‚òÅÔ∏è</span>
                    <span>WebDAV Sync</span>
                </button>
                <button class="action-btn" id="act-export">
                    <span class="action-icon">üì¶</span>
                    <span>Backup to File</span>
                </button>
                <button class="action-btn" id="act-import">
                    <span class="action-icon">üì•</span>
                    <span>Restore from File</span>
                </button>
                <button class="action-btn" id="act-ai">
                    <span class="action-icon">ü§ñ</span>
                    <span>AI Settings</span>
                </button>
            </div>
            <button class="action-btn cancel-btn" id="act-cancel">Cancel</button>
        </div>
    </div>
    </div>

    <!-- Hidden Input for Import -->
    <input type="file" id="file-import-input" accept=".json" style="display:none" />

    <!-- Scripts - STRICT ORDER REQUIRED -->
    <!-- 1. Database & Storage Layer -->
    <script src="modules/idb-utils.js"></script>
    <script src="modules/storage-bridge.js"></script>

    <!-- 3rd Party Libs -->
    <script src="tesseract.min.js"></script>
    <!-- 2. Core Utils -->
    <script src="ai-core-mobile.js"></script>
    <script src="modules/memory-agent.js"></script>

    <!-- 3. App Logic -->
    <script src="mobile-sync.js"></script> <!-- Must be before core if core uses it lightly, or core binds it -->
    <script src="mobile-gdrive.js"></script>
    <script src="mobile-core.js"></script> <!-- Core binds events -->
    <script src="mobile-chat.js"></script>
    <script src="mobile-editor.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(() => console.log('SW Registered'))
                .catch(err => console.log('SW Error:', err));
        }
    </script>
</body>

</html>