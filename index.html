<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Highlighti Mobile</title>
    <link rel="stylesheet" href="mobile.css">
    <link rel="manifest" href="mobile-manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2965/2965358.png">
</head>







<body>
    <div id="app">
        <!-- ============================== -->
        <!-- 1. VIEW HOME (Highlights Feed) -->
        <!-- ============================== -->
        <div id="view-home" class="app-view active">
            <header class="notes-header">
                <button class="header-btn menu-btn">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M3 12h18M3 6h18M3 18h18" />
                    </svg>
                </button>
                <h1 class="header-title">Highlighti</h1>
                <button class="header-btn user-btn">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.8">
                        <circle cx="12" cy="8" r="4" />
                        <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" />
                    </svg>
                </button>
            </header>

            <main class="notes-list-content">
                <div class="list-title" style="font-size:14px; color:#8e8e93; margin-top:20px; margin-bottom:10px;">
                    SMART FEED</div>

                <div class="list-title" style="font-size:14px; color:#8e8e93; margin-top:20px; margin-bottom:10px;">
                    SMART FEED</div>
                <!-- Dynamic Content Will Be Injected Here -->
                <div id="home-dyn-list"></div>
            </main>
        </div>

        <!-- ============================== -->
        <!-- 2. VIEW SEARCH -->
        <!-- ============================== -->
        <div id="view-search" class="app-view">
            <header class="notes-header">
                <h1 class="header-title" style="position:static; transform:none; flex:1;">Search</h1>
            </header>
            <div class="search-bar-container">
                <div class="search-bar">
                    <span class="search-icon">
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24">
                            <circle cx="11" cy="11" r="8" />
                            <line x1="21" y1="21" x2="16.65" y2="16.65" />
                        </svg>
                    </span>
                    <input type="text" placeholder="Search chats, reader...">
                </div>
            </div>
            <main class="notes-list-content">
                <div class="list-title">Recent Searches</div>
                <!-- Recent searches placeholder -->
            </main>
        </div>

        <!-- ============================== -->
        <!-- 3. VIEW READER (List) -->
        <!-- ============================== -->
        <div id="view-reader" class="app-view">
            <header class="notes-header">
                <h1 class="header-title">Reader</h1>
                <button class="header-btn" style="margin-left:auto;">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                </button>
            </header>
            <main class="notes-list-content">
                <div class="note-card" onclick="mobileCore.navigateTo('reader-detail')">
                    <div style="display:flex; gap:12px;">
                        <div
                            style="width:60px; height:60px; background:#f2f2f7; border-radius:8px; display:flex; align-items:center; justify-content:center;">
                            <svg width="24" height="24" stroke="#c7c7cc" stroke-width="1.5" fill="none"
                                viewBox="0 0 24 24">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                                <circle cx="8.5" cy="8.5" r="1.5" />
                                <polyline points="21 15 16 10 5 21" />
                            </svg>
                        </div>
                        <div style="flex:1;">
                            <div class="note-title">Urban Planning Innovations</div>
                            <div class="note-preview" style="margin-top:4px;">Exploring sustainable city
                                development...
                            </div>
                            <div class="note-time" style="margin-top:4px; font-size:12px;">NatGeo ‚Ä¢ 5 min read
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- ============================== -->
        <!-- 4. VIEW NOTES (List) -->
        <!-- ============================== -->
        <div id="view-notes" class="app-view">
            <header class="notes-header">
                <h1 class="header-title">Notes</h1>
                <button class="header-btn" style="margin-left:auto;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14" />
                    </svg>
                </button>
            </header>
            <main class="notes-list-content">
                <div id="notes-dyn-list"></div>
            </main>
        </div>

        <!-- ============================== -->
        <!-- 5. VIEW CHAT (Tab / Full Screen) -->
        <!-- ============================== -->
        <div id="view-chat" class="app-view">
            <header class="gemini-header">
                <!-- Back Button for Full Screen Mode -->
                <button class="header-btn back-btn" onclick="mobileCore.exitChat()">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <h1 class="header-title" id="chat-title">Today</h1>
                <button class="header-btn" id="btn-settings">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="1" />
                        <circle cx="19" cy="12" r="1" />
                        <circle cx="5" cy="12" r="1" />
                    </svg>
                </button>
            </header>
            <main id="chat-content" class="chat-content">
                <div id="messages-container"></div>
            </main>
            <div class="input-area">
                <div class="input-tools-row">
                    <button class="tool-btn">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5"
                            viewBox="0 0 24 24">
                            <path
                                d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                            <circle cx="12" cy="13" r="4" />
                        </svg>
                    </button>
                    <div class="input-field-wrapper">
                        <input type="text" id="chat-input" class="chat-input-field" placeholder="Message">
                    </div>
                    <button class="tool-btn" id="btn-mic">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5"
                            viewBox="0 0 24 24">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" />
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                            <line x1="12" y1="19" x2="12" y2="23" />
                            <line x1="8" y1="23" x2="16" y2="23" />
                        </svg>
                    </button>
                    <button class="tool-btn" id="btn-add">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24">
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================== -->
        <!-- 3. VIEW READER (List) -->
        <!-- ============================== -->
        <div id="view-reader" class="app-view">
            <header class="gemini-header">
                <h1 class="header-title">Reading List</h1>
            </header>
            <main class="reading-list-content" style="padding:16px; overflow-y:auto;">
                <div id="reader-dyn-list"></div>
            </main>
        </div>

        <!-- ============================== -->
        <!-- SUB-VIEW: EDITOR (Full Screen) -->
        <!-- ============================== -->
        <div id="view-editor" class="app-view full-screen-view">
            <header class="gemini-header">
                <button class="header-btn back-btn" onclick="mobileEditor.saveNote(); mobileCore.goBack()">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <input class="editor-title" placeholder="Title" value="Untitled">
                <!-- Editor Menu -->
                <button class="header-btn">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="1" />
                        <circle cx="19" cy="12" r="1" />
                        <circle cx="5" cy="12" r="1" />
                    </svg>
                </button>
            </header>
            <main class="editor-content">
                <h1 class="editor-title">Project Plan</h1>
                <div class="editor-body" contenteditable="true">
                    Start typing...
                </div>
            </main>
            <div class="editor-toolbar">
                <button class="toolbar-btn">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5"
                        viewBox="0 0 24 24">
                        <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z" />
                        <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z" />
                    </svg>
                </button>
                <button class="toolbar-btn">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5"
                        viewBox="0 0 24 24">
                        <line x1="19" y1="4" x2="10" y2="4" />
                        <line x1="14" y1="20" x2="5" y2="20" />
                        <line x1="15" y1="4" x2="9" y2="20" />
                    </svg>
                </button>
                <button class="toolbar-btn">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <line x1="8" y1="6" x2="21" y2="6" />
                        <line x1="8" y1="12" x2="21" y2="12" />
                        <line x1="8" y1="18" x2="21" y2="18" />
                        <line x1="3" y1="6" x2="3.01" y2="6" />
                        <line x1="3" y1="12" x2="3.01" y2="12" />
                        <line x1="3" y1="18" x2="3.01" y2="18" />
                    </svg>
                </button>
                <div class="spacer"></div>
                <!-- AI Context Activation -->
                <button class="toolbar-btn" id="btn-ai-toolbar" style="color:var(--ios-blue)">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- ============================== -->
        <!-- SUB-VIEW: READER DETAIL (Full Screen) -->
        <!-- ============================== -->
        <div id="view-reader-detail" class="app-view full-screen-view">
            <header class="gemini-header">
                <button class="header-btn back-btn" onclick="mobileCore.goBack()">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <div style="flex:1; text-align:center; font-weight:600;">Reader View</div>
                <button class="header-btn">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
                    </svg>
                </button>
            </header>
            <main class="editor-content">
                <h1 class="editor-title" style="font-size:24px;">The Future of AI</h1>
                <div class="note-time" style="margin-bottom:20px;">TechCrunch ‚Ä¢ 5 min read</div>
                <div style="width:100%; height:200px; background:#f0f0f0; border-radius:12px; margin-bottom:20px;">
                </div>
                <div class="editor-body" style="font-family:Georgia, serif;">
                    <p>Artificial Intelligence is reshaping our world...</p>
                    <p>In recent years, we have seen exponential growth in...</p>
                </div>
            </main>
            <!-- Reader Context AI -->
            <div class="editor-toolbar">
                <button class="toolbar-btn">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8" />
                        <line x1="21" y1="21" x2="16.65" y2="16.65" />
                    </svg>
                </button>
                <div class="spacer"></div>
                <button class="toolbar-btn" style="color:var(--ios-blue); width:auto; gap:4px; padding:0 8px;">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                    </svg>
                    <span>Summarize</span>
                </button>
            </div>
        </div>

        <!-- ============================== -->
        <!-- GLOBAL: BOTTOM TAB BAR -->
        <!-- ============================== -->
        <nav class="bottom-tab-bar" id="main-tab-bar">
            <!-- 1. Home (Highlights) -->
            <button class="tab-btn active" data-target="view-home">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                    <polyline points="9 22 9 12 15 12 15 22" />
                </svg>
                <span style="font-size:10px; margin-top:2px;">Home</span>
            </button>

            <!-- 1.5 Chat -->
            <button class="tab-btn" data-target="view-chat">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <!-- Chat Bubble Icon -->
                    <path
                        d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" />
                </svg>
                <span style="font-size:10px; margin-top:2px;">Chat</span>
            </button>

            <!-- 2. Search -->
            <button class="tab-btn" data-target="view-search">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8" />
                    <line x1="21" y1="21" x2="16.65" y2="16.65" />
                </svg>
                <span style="font-size:10px; margin-top:2px;">Search</span>
            </button>
            <!-- 3. Reader -->
            <button class="tab-btn" data-target="view-reader">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
                </svg>
                <span style="font-size:10px; margin-top:2px;">Reader</span>
            </button>
            <!-- 4. Notes -->
            <button class="tab-btn" data-target="view-notes">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                    <polyline points="14 2 14 8 20 8" />
                    <line x1="16" y1="13" x2="8" y2="13" />
                    <line x1="16" y1="17" x2="8" y2="17" />
                    <polyline points="10 9 9 9 8 9" />
                </svg>
                <span style="font-size:10px; margin-top:2px;">Notes</span>
            </button>
        </nav>

    </div>


    <!-- ============================== -->
    <!-- OVERLAY: ACTION SHEET -->
    <!-- ============================== -->
    <div id="action-sheet-overlay" class="action-sheet-overlay hidden">
        <div class="action-sheet">
            <button class="action-btn" id="act-gdrive">
                <span class="action-icon">üîÑ</span>
                <span>Google Drive Sync</span>
            </button>
            <button class="action-btn" id="act-webdav">
                <span class="action-icon">‚òÅÔ∏è</span>
                <span>WebDAV Sync</span>
            </button>
            <button class="action-btn" id="act-export">
                <span class="action-icon">ÔøΩ</span>
                <span>Backup to File</span>
            </button>
            <button class="action-btn" id="act-import">
                <span class="action-icon">üì•</span>
                <span>Restore from File</span>
            </button>
            <button class="action-btn" id="act-ai">
                <span class="action-icon">ü§ñ</span>
                <span>AI Settings</span>
            </button>
        </div>
        <button class="action-btn cancel-btn" id="act-cancel" style="margin-top:12px;">Cancel</button>
    </div>
    </div>

    <!-- Hidden Input for Import -->
    <input type="file" id="file-import-input" accept=".json" style="display:none" />

    <!-- Scripts - STRICT ORDER REQUIRED -->
    <!-- 1. Database & Storage Layer -->
    <script src="modules/idb-utils.js"></script>
    <script src="modules/storage-bridge.js"></script>

    <!-- 2. Core Utils -->
    <script src="ai-core-mobile.js"></script>
    <script src="modules/memory-agent.js"></script>

    <!-- 3. App Logic -->
    <script src="mobile-sync.js"></script> <!-- Must be before core if core uses it lightly, or core binds it -->
    <script src="mobile-gdrive.js"></script>
    <script src="mobile-core.js"></script> <!-- Core binds events -->
    <script src="mobile-chat.js"></script>
    <script src="mobile-editor.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(() => console.log('SW Registered'))
                .catch(err => console.log('SW Error:', err));
        }
    </script>
</body>

</html>